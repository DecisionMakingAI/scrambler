<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Joystick Testing - Scrambler</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Joystick Testing";
    var mkdocs_page_input_path = "swdesign/joystick.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Scrambler</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../index.html">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../initialsetup.html">Initial Setup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Final Assembly</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../finalassy/introduction.html">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/batteryprep.html">Battery Prep</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/drivebattery.html">Install Drive Battery</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/processorbattery.html">Install Processor Battery</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/testvoltageregulator.html">Test Voltage Regulator</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/cameramount.html">Camera Mount</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/rollbarassembly.html">Roll Bar Assembly</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/finalhookup.html">Final Hook Up</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../powermonitor.html">Power Monitoring</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chargingbatteries.html">Charging Batteries</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../headless_setup.html">Headless Setup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../generalnotes.html">General Operating Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hardware Assembly</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../hwassy/introduction.html">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwassy/cableprep.html">Cable Preparation</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwassy/hwassy.html">Hardware Assembly</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../setup_jetson_nano.html">Software Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sd_card_backup.html">Software Backup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hardware Design Notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../hwdesign/enhancements.html">Enhancements</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/powerdesign.html">Power Design</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/wiremanagement.html">Wire Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/mountingparts.html">Mounting Parts</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/cameramount.html">Camera Mount</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Software Design Notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="workenv.html">Work Environment</a>
                </li>
                <li class="">
                    
    <a class="" href="hotspot.html">Hotspot Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="camera.html">Pi Camera Usage</a>
                </li>
                <li class="">
                    
    <a class="" href="webstream.html">Simple Web Streamer</a>
                </li>
                <li class="">
                    
    <a class="" href="sysmon.html">System Monitor</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="joystick.html">Joystick Testing</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    

    <li class="toctree-l3"><a href="#jstest-gtk">jstest-gtk</a></li>
    

    <li class="toctree-l3"><a href="#js_linuxpy-program">js_linux.py program</a></li>
    

    <li class="toctree-l3"><a href="#joystick-driver">Joystick Driver</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="camera_cal.html">Camera Calibration</a>
                </li>
                <li class="">
                    
    <a class="" href="gstreamer.html">GSTREAMER Python Bindings</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Scrambler</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Software Design Notes &raquo;</li>
        
      
    
    <li>Joystick Testing</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="introduction">Introduction</h2>
<p>Explore the basic connections to interfacing with the joystick.
Looking for simple interface so that it can be used for other test programs.
In looking at the donkey car interface, they build a driver through <em>ioictl</em> calls to the joystick port in linux (<em>/dev/input/js0</em>).
Since we are only using the Logitech F710, we won't worry about the plethora of other types to interface to.</p>
<p>It would probably suffice to lift the necessary parts from the <em>controller.py</em> file in the donkey car, but we'll start with a standard linux test program.</p>
<p>When looking into the joystick interface there are many terms and definitions that come up.
The <a href="https://www.kernel.org/doc/html/latest/input/joydev/index.html">Linux Kernel Documentation</a> provides a great amount of detail on this information.</p>
<h2 id="jstest-gtk">jstest-gtk</h2>
<p>This is a simple joystick tester written in c++ and can be found at the <a href="https://github.com/Grumbel/jstest-gtk/tree/master">jstest-gtk</a>.</p>
<p>It has been downloaded into the ~/project/jstest directory.
The README.md gives the necessary instructions to compile and run it.
Before running this, you will want to remotely log in via:</p>
<pre><code class="bash">ssh -X donkey@scrambler.local
</code></pre>

<p>since it brings up a window displaying the joystick controls.</p>
<p>Before compiling, you will also have to do the following to get thenecessary libraies:</p>
<pre><code class="bash">sudo apt-get install sigc++
sudo apt-get install libgtkmm-3.0-dev
</code></pre>

<p>Once compiled it can be executed from the build directory via:</p>
<pre><code class="bash">./jstest-gtk /dev/input/js0
</code></pre>

<div style="text-align:center"><img src="sw_img/gamepad.png" width="480" /></div>

<p><br></p>
<h2 id="js_linuxpy-program">js_linux.py program</h2>
<p>This <a href="https://gist.github.com/rdb/8864666">js_linux.py</a> was grabbed from the internet.
It is rather simple and runs straight away, so it should serve as a vehicle to quickly generate drivers that we are interested in.
It also appears that this was the driver that the Donkeycar used to develop their joystick (controller.py) from.</p>
<h2 id="joystick-driver">Joystick Driver</h2>
<p>Converted js_linux.py to class Joystick and added a subclass of F710Joystick.
In addition, reading of the joystick values was converted to nonblocking I/O.
This seems to make sense for more general usage.
A timeout on the read time could also have been used, or even more generically, put a polling loop as a separate thread.</p>
<p>For now, it is left as a simple driver that must be polled regularly to keep the event queue on the joystick from filling up.
It keeps a current state of the joysticks and buttons.
It also can just return events as they come in.
Final tweaks can wait until we put it in an application and see what is really needed.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="camera_cal.html" class="btn btn-neutral float-right" title="Camera Calibration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="sysmon.html" class="btn btn-neutral" title="System Monitor"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="sysmon.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="camera_cal.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
