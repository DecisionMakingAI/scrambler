<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Simple Web Streamer - Scrambler</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Simple Web Streamer";
    var mkdocs_page_input_path = "swdesign/webstream.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Scrambler</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../index.html">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../initialsetup.html">Initial Setup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Final Assembly</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../finalassy/introduction.html">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/batteryprep.html">Battery Prep</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/drivebattery.html">Install Drive Battery</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/processorbattery.html">Install Processor Battery</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/testvoltageregulator.html">Test Voltage Regulator</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/cameramount.html">Camera Mount</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/rollbarassembly.html">Roll Bar Assembly</a>
                </li>
                <li class="">
                    
    <a class="" href="../finalassy/finalhookup.html">Final Hook Up</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../powermonitor.html">Power Monitoring</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../chargingbatteries.html">Charging Batteries</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../headless_setup.html">Headless Setup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../generalnotes.html">General Operating Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hardware Assembly</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../hwassy/introduction.html">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwassy/cableprep.html">Cable Preparation</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwassy/hwassy.html">Hardware Assembly</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../setup_jetson_nano.html">Software Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sd_card_backup.html">Software Backup</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hardware Design Notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../hwdesign/enhancements.html">Enhancements</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/powerdesign.html">Power Design</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/wiremanagement.html">Wire Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/mountingparts.html">Mounting Parts</a>
                </li>
                <li class="">
                    
    <a class="" href="../hwdesign/cameramount.html">Camera Mount</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Software Design Notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="workenv.html">Work Environment</a>
                </li>
                <li class="">
                    
    <a class="" href="hotspot.html">Hotspot Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="camera.html">Pi Camera Usage</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="webstream.html">Simple Web Streamer</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    

    <li class="toctree-l3"><a href="#video-streaming-app">Video Streaming App</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="sysmon.html">System Monitor</a>
                </li>
                <li class="">
                    
    <a class="" href="joystick.html">Joystick Testing</a>
                </li>
                <li class="">
                    
    <a class="" href="camera_cal.html">Camera Calibration</a>
                </li>
                <li class="">
                    
    <a class="" href="gstreamer.html">GSTREAMER Python Bindings</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Scrambler</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Software Design Notes &raquo;</li>
        
      
    
    <li>Simple Web Streamer</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="introduction">Introduction</h2>
<p>In order to get resonable video over the to the remote host display, the video stream needs to be compressed then transmitted.
The host needs to have something running to receive and display this.</p>
<p>A common approach to this is to use the web browser.
Jupyter notebooks does this as well as the donkeycar software.</p>
<p>To start with, I went looking for a simple app to test this out and see what limitations there are.
<a href="https://maker.pro/nvidia-jetson/tutorial/streaming-real-time-video-from-rpi-camera-to-browser-on-jetson-nano-with-flask">Using Jetson for Video Streaming</a> discusses video streaming for the Jetson Nano.
This program runs, but does not stream uniformly as the video is not sent out smoothly.</p>
<p><a href="https://blog.miguelgrinberg.com/post/video-streaming-with-flask">Video Streaming with Flask</a> gives a more general discussion of the video streaming process.
It was not set up for the nano and suffers many of the same problems.</p>
<p><a href="https://blog.miguelgrinberg.com/post/flask-video-streaming-revisited">Flask Video Streaming Revisited</a> is upgraded from the previous article and addresses more improvements and robustness issues.
This program has been modified to run on the nano and the details are discussed below.</p>
<p>Naturally, not being an expert on any of these tools, a little study was needed to sort this code out.
Flask is the framework used to accomplish this.  There is a good tutorial on the from <a href="https://www.freecodecamp.org/news/how-to-build-a-web-application-using-flask-and-deploy-it-to-the-cloud-3551c985e492/">freecodecamp</a>.</p>
<p>In viewing this tutorial, one of the first things discovered is that they use python decorators. The <a href="https://www.datacamp.com/community/tutorials/decorators-python">Decorators in Python</a> web page covers this in detail.</p>
<p>Threading is central to running this web app, a tutorial on <a href="https://realpython.com/intro-to-python-threading/">threading</a> was consulted.</p>
<p>After all is said and done, these example apps did not handle shutting down the Jetson CSI Camera very well.
If this is not cleanly done, you are forced to do a reboot to fix the problem.
In addition, what appeared to be the best written program, turned out to be very difficult to follow and I couldn't figure out where to insert the necessary code to insure the camera would shutdown correctly.
After about so much time, it was time to consider writing the necessary code from scratch.</p>
<h2 id="video-streaming-app">Video Streaming App</h2>
<p>To run the app, from the host:</p>
<pre><code class="bash">    ssh donkey@scrambler.local

    # After logging in...
    pip install flask       # if not already installed

    cd ~/projects/camera/WebStream
    python web_stream.py
</code></pre>

<p>One the host, open a blank web page in your chrome browser and enter:</p>
<pre><code class="bash">    scrambler.local:8000
</code></pre>

<p>or if the car is connected to a display you can issue the browser command:</p>
<pre><code class="bash">    localhost:8000
</code></pre>

<p>Note: you may have to substute the IP address for scrambler.local.</p>
<p>You should see the camera output on the display.</p>
<p>This program also supports streaming to multiple devices, but performance may get sluggish rather quickly.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sysmon.html" class="btn btn-neutral float-right" title="System Monitor">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="camera.html" class="btn btn-neutral" title="Pi Camera Usage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="camera.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="sysmon.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
